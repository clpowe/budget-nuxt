<template>
  <div
    class="grid h-screen w-screen place-content-center p-4 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-teal-500 to-cyan-600"
  >
    <div class="mb-8 grid gap-4 justify-items-center">
      <div>
        <svg
          width="62"
          height="62"
          viewBox="0 0 85 85"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clip-path="url(#clip0_11_470)">
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M81.5 59.4C83.75 54.22 85 48.51 85 42.5C85 19.03 65.97 0 42.5 0C19.03 0 0 19.03 0 42.5C0 56.42 6.69 68.77 17.03 76.52L8.61997 44.75L8.63997 44.66C8.61997 44.56 8.61997 44.46 8.61997 44.35C8.60997 44.18 8.62997 44 8.64997 43.83L8.71997 43.51C8.76997 43.33 8.82997 43.17 8.91997 42.99C8.92575 42.9785 8.9318 42.9662 8.93815 42.9534C9.0088 42.8105 9.1173 42.5911 9.30997 42.38C9.31997 42.36 9.36997 42.3 9.36997 42.3L32.62 12.48C33.47 11.4 34.94 11.01 36.21 11.53L71.16 25.91C72.16 26.23 72.93 27.03 73.19 28.02L81.5 59.4ZM77.35 66.83L24.24 80.89C29.77 83.52 35.96 85 42.5 85C56.92 85 69.66 77.82 77.35 66.83ZM65.35 30.16L36.03 18.08L16.5 43.12L37.69 52.62L51.24 49.03L65.35 30.16ZM16.29 49.74L21.83 70.67L32.08 56.83L16.29 49.74ZM38.24 58.82L27.17 73.77L69.84 62.47L52.33 55.09L38.24 58.82ZM68.88 35.68L57.68 50.68L74.75 57.88L68.88 35.68Z"
              fill="white"
            />
          </g>
          <defs>
            <clipPath id="clip0_11_470">
              <rect width="85" height="85" fill="white" />
            </clipPath>
          </defs>
        </svg>
      </div>
      <div>
        <svg
          height="50"
          viewBox="0 0 219 50"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clip-path="url(#clip0_11_474)">
            <path
              d="M0.5 31.7162L9.02254 0.426758H31.6655L29.8026 7.27277H15.6915L14.2292 12.6531H27.176L25.3132 19.4991H12.3664L10.904 24.8794H24.9499L23.0871 31.7255H0.5V31.7162Z"
              fill="white"
            />
            <path
              d="M61.2103 0.426758L52.6877 31.7069H45.5717L38.6977 15.2691H38.5115L34.0313 31.7069H25.4995L34.0313 0.426758H41.2685L47.9747 16.7997H48.2169L52.6784 0.426758H61.2103Z"
              fill="white"
            />
            <path
              d="M69.1926 0.426758L69.6303 22.4861H69.8725L82.3164 0.426758H91.9473L73.058 31.7069H61.3966L59.5616 0.426758H69.1926Z"
              fill="white"
            />
            <path
              d="M81.7761 31.7162L90.2987 0.426758H112.942L111.079 7.27277H96.9677L95.5053 12.6531H108.452L106.589 19.4991H93.6425L92.1801 24.8794H106.226L104.363 31.7255H81.7854L81.7761 31.7162Z"
              fill="white"
            />
            <path
              d="M106.785 31.7162L115.307 0.426758H123.839L117.18 24.8702H129.875L128.012 31.7162H106.785Z"
              fill="white"
            />
            <path
              d="M162.121 16.0668C161.171 19.5455 159.69 22.4861 157.678 24.8701C155.666 27.2542 153.338 29.0631 150.692 30.2968C148.047 31.5213 145.299 32.1336 142.458 32.1336C139.618 32.1336 137.177 31.5121 135.212 30.2783C133.247 29.0445 131.905 27.2263 131.198 24.8423C130.49 22.4583 130.611 19.5269 131.551 16.0668C132.492 12.6067 133.973 9.6475 135.985 7.26345C137.997 4.87941 140.316 3.0705 142.952 1.83673C145.588 0.602968 148.345 0 151.205 0C154.064 0 156.458 0.612245 158.432 1.83673C160.407 3.06122 161.748 4.87013 162.465 7.26345C163.183 9.65677 163.052 12.5881 162.112 16.0668H162.121ZM153.347 16.0668C153.859 14.1929 154.036 12.616 153.896 11.3265C153.747 10.0371 153.291 9.06308 152.499 8.39518C151.717 7.72727 150.618 7.39332 149.202 7.39332C147.786 7.39332 146.51 7.72727 145.365 8.39518C144.219 9.06308 143.222 10.0371 142.375 11.3265C141.527 12.616 140.847 14.1929 140.335 16.0668C139.823 17.9406 139.646 19.5176 139.785 20.8071C139.925 22.0965 140.391 23.0705 141.182 23.7384C141.965 24.4063 143.064 24.7403 144.48 24.7403C145.895 24.7403 147.171 24.4063 148.317 23.7384C149.463 23.0705 150.459 22.0965 151.307 20.8071C152.155 19.5176 152.835 17.9406 153.347 16.0668Z"
              fill="white"
            />
            <path
              d="M159.923 31.7162L168.445 0.426758H182.007C184.335 0.426758 186.254 0.881303 187.754 1.79967C189.253 2.71804 190.259 4.00746 190.781 5.66794C191.302 7.32843 191.256 9.2672 190.65 11.4843C190.036 13.7292 189.011 15.6679 187.567 17.3006C186.124 18.9333 184.382 20.2041 182.351 21.0854C180.321 21.9666 178.104 22.4119 175.71 22.4119H167.616L169.414 15.8164H175.794C176.8 15.8164 177.704 15.6401 178.505 15.2876C179.315 14.9351 179.995 14.4342 180.554 13.7848C181.113 13.1355 181.513 12.3655 181.755 11.475C181.997 10.5845 182.016 9.81451 181.811 9.17444C181.606 8.53436 181.187 8.05199 180.572 7.70876C179.958 7.36553 179.147 7.19856 178.141 7.19856H175.133L168.455 31.6976H159.923V31.7162Z"
              fill="white"
            />
            <path
              d="M187.335 31.7162L195.857 0.426758H218.5L216.637 7.27277H202.526L201.064 12.6531H214.011L212.148 19.4991H199.201L197.739 24.8794H211.784L209.922 31.7255H187.344L187.335 31.7162Z"
              fill="white"
            />
            <path
              d="M143.232 36.5215H146.715L147.954 45.4547H148.112L154.222 36.5215H157.706L154.083 49.8146H151.344L153.701 41.1597H153.589L147.796 49.7497H145.933L144.824 41.1319H144.713L142.347 49.8146H139.608L143.232 36.5215Z"
              fill="white"
            />
            <path
              d="M168.864 43.1727C168.473 44.6198 167.858 45.8536 167.029 46.874C166.2 47.8944 165.241 48.6643 164.151 49.2024C163.062 49.7404 161.925 50.0001 160.752 50.0001C159.578 50.0001 158.572 49.7311 157.78 49.1931C156.979 48.655 156.448 47.8758 156.178 46.8647C155.908 45.8536 155.973 44.6198 156.365 43.1727C156.756 41.7255 157.371 40.4918 158.19 39.4714C159.01 38.451 159.969 37.681 161.059 37.143C162.149 36.605 163.285 36.3452 164.468 36.3452C165.651 36.3452 166.638 36.6142 167.43 37.143C168.231 37.681 168.762 38.451 169.041 39.4714C169.311 40.4918 169.256 41.7255 168.855 43.1727H168.864ZM166.005 43.1727C166.256 42.2358 166.34 41.438 166.228 40.7979C166.126 40.1578 165.865 39.6662 165.446 39.3322C165.027 38.9983 164.477 38.8313 163.797 38.8313C163.117 38.8313 162.475 38.9983 161.879 39.3322C161.283 39.6662 160.752 40.1578 160.295 40.7979C159.839 41.4473 159.485 42.2358 159.224 43.1727C158.963 44.1096 158.889 44.9074 159.001 45.5474C159.103 46.1875 159.364 46.6792 159.783 47.0131C160.202 47.3471 160.752 47.514 161.432 47.514C162.112 47.514 162.754 47.3471 163.35 47.0131C163.946 46.6792 164.477 46.1875 164.934 45.5474C165.39 44.9074 165.744 44.1096 166.005 43.1727Z"
              fill="white"
            />
            <path
              d="M183.041 36.5215L179.417 49.8146H176.977L173.447 41.4473H173.345L171.063 49.8146H168.24L171.864 36.5215H174.341L177.825 44.8796H177.946L180.228 36.5215H183.041Z"
              fill="white"
            />
            <path
              d="M180.861 49.8146L184.484 36.5215H193.482L192.849 38.8406H186.673L185.807 42.0039H191.517L190.883 44.323H185.174L184.307 47.4955H190.501L189.868 49.8146H180.852H180.861Z"
              fill="white"
            />
            <path
              d="M191.479 36.5215H194.646L196.127 42.245H196.258L200.859 36.5215H204.016L196.807 45.1115L195.531 49.8146H192.727L194.004 45.1115L191.479 36.5215Z"
              fill="white"
            />
          </g>
          <defs>
            <clipPath id="clip0_11_474">
              <rect
                width="218"
                height="50"
                fill="white"
                transform="translate(0.5)"
              />
            </clipPath>
          </defs>
        </svg>
      </div>
    </div>
    <form v-if="!isSignUp" @submit.prevent="signUp" class="grid">
      <input type="text" v-model="name" placeholder="Enter Your" />
      <input type="email" v-model="email" placeholder="Enter Email" />
      <input type="password" v-model="password" placeholder="Enter Password" />
      <button type="submit" class="btn btn-sm btn-secondary">
        <span>Sign up</span>
      </button>
    </form>
    <form v-else @submit.prevent="login" class="grid">
      <input type="email" v-model="email" placeholder="Enter Email" />
      <input type="password" v-model="password" placeholder="Enter Password" />
      <button type="submit" class="btn btn-sm btn-secondary">
        <span>Log in</span>
      </button>
    </form>
    <button @click="isSignUp = !isSignUp">
      <span v-show="isSignUp">Create a new account</span>
      <span v-show="!isSignUp"
        >Have an account? <span class="font-bold">Log in instead</span></span
      >
    </button>
  </div>
</template>

<script setup>
const name = ref("");
const email = ref("");
const password = ref("");
const isSignUp = ref(false);
const client = useSupabaseAuthClient();

async function login() {
  const { error } = await client.auth.signInWithPassword({
    email: email.value,
    password: password.value,
  });
  if (error) {
    console.log(error);
  }
  navigateTo("/account/");
}

definePageMeta({
  layout: "login",
});

async function signUp() {
  const { data: userData, error } = await client.auth.signUp({
    email: email.value,
    password: password.value,
  });
  if (error) {
    console.error(error);
    throw new Error(error);
  }

  try {
    await client.from("profiles").insert([
      {
        user_id: userData.user.id,
        name: name.value,
        id: userData.user.id,
      },
    ]);
  } catch (error) {
    console.error(error);
    throw new Error(error);
  }

  navigateTo("/account/");
}
</script>

<style scoped>
input {
  @apply input input-bordered w-full max-w-md;
}

form {
  @apply grid gap-4;
}
</style>
